# 日本株ウォッチドッグ v2.0.0

株式市場学習・研究専用ツール（Streamlit Web版）

## 🚨 重要：プロジェクト方針

**このツールは学習・研究専用です**
- ✅ **メイン投資**: インデックス投資(オルカン等) 90-95%
- 🧪 **このツール**: 市場理解のための学習 0%実投資
- **投資判断は必ずご自身の責任で行ってください**

## 📋 主要機能

### 🔥 v2.0.0 新機能：統一データベース
- **「両方の真実を保持」**: 証券会社とYahoo Financeの両方のデータを表示
- **単位不一致問題解決**: SBI証券の167.98%とYahoo Financeの0.1598を統一管理
- **計算なし比較**: データベースから直接取り出すだけで比較可能
- **J-Quants準備完了**: 95%の統合可能性を確認済み

### 🏗️ 統一データ処理アーキテクチャ v2.0.0
- **完全データ整合性**: 全データソースの統一管理
- **両方表示**: 証券会社データとAPI データを透明性をもって併記
- **自動単位変換**: 9432.T → 9432、%値 ⇔ 小数値の相互変換
- **適応的API制限**: Yahoo Finance・J-Quants対応の賢いレート制限

### 💼 4つの主要画面
1. **📊 ポートフォリオ管理**: SBI・楽天証券CSV対応、リアルタイム損益分析
2. **👀 監視リスト**: 欲しい銘柄追跡、投資タイミング判定
3. **🎯 投資戦略分析**: 5戦略による包括的評価
4. **📈 金融チャート**: 配当・財務データ可視化

### 🗄️ データベース機能
- **SQLiteベース**: ローカル実行でプライバシー保護
- **5テーブル構成**: ポートフォリオ、銘柄マスター、財務指標、API管理、設定
- **エンハンスドCSVパーサー**: 32件データを正常処理確認済み
- **データ検証**: 異常値自動検出・修正機能

### 🎯 5つの投資戦略
- **ディフェンシブ戦略**: 低リスク・安定配当重視
- **グロース戦略**: 成長性重視
- **バリュー戦略**: 割安性重視
- **配当戦略**: 配当収入重視
- **モメンタム戦略**: 市場の勢い重視

## 🚀 クイックスタート

### 1. 環境セットアップ

```bash
# リポジトリクローン
git clone https://github.com/inata169/J_Stock_StreamlitV2.git
cd J_Stock_StreamlitV2

# 仮想環境作成（推奨）
python -m venv .venv

# 仮想環境有効化
# Windows:
.venv\Scripts\activate
# Linux/Mac:
source .venv/bin/activate

# 依存関係インストール
pip install -r requirements.txt
```

### 2. アプリケーション起動

```bash
# Streamlitアプリ起動
streamlit run app.py

# ブラウザでアクセス
# http://localhost:8501
```

### 3. 基本的な使い方

1. **ポートフォリオ管理**
   - SBI・楽天証券のCSVファイルをアップロード
   - リアルタイム損益分析と投資アドバイス

2. **監視リスト**
   - 興味のある銘柄を追加
   - 投資タイミングの自動判定

3. **戦略分析**
   - 銘柄コード入力（例：1928.T, AAPL）
   - 5つの戦略による総合評価

4. **チャート**
   - 配当利回り比較
   - 配当履歴分析
   - 財務指標レーダーチャート

## 📁 プロジェクト構造

```
J_Stock_StreamlitV2/
├── app.py                          # メインアプリケーション
├── requirements.txt                # 依存関係
├── CLAUDE.md                      # 開発仕様書（技術詳細）
├── README.md                      # このファイル（ユーザーガイド）
├── .gitignore                     # Git除外設定
├── .streamlit/                    # Streamlit設定
│   ├── config.toml               # アプリ設定
│   └── secrets.toml.template     # シークレット設定テンプレート
├── core/                          # v2.0.0 統一データ基盤
│   ├── __init__.py
│   ├── database_init.py          # SQLiteデータベース初期化
│   ├── database_manager.py       # データベースアクセス層
│   ├── symbol_utils.py           # 銘柄コード正規化（9432.T→9432）
│   ├── enhanced_csv_parser.py    # 新CSVパーサー（32件処理済）
│   ├── api_rate_manager.py       # 適応的API制限管理
│   ├── financial_data_processor.py # 統一データ処理層
│   ├── multi_data_source.py      # データ取得層
│   ├── investment_strategies.py  # 投資戦略分析層
│   └── chart_data_manager.py     # チャート生成層
├── pages/                         # Streamlit UI層
│   ├── __init__.py
│   ├── portfolio.py              # ポートフォリオ管理画面
│   ├── watchlist.py              # 監視リスト画面
│   ├── strategy.py               # 戦略分析画面
│   └── charts.py                 # チャート画面
├── database_schema.sql            # データベーススキーマ定義
├── stock_watchdog.db             # SQLiteデータベース（自動生成）
└── cache/                        # APIキャッシュ（自動生成）
```

## 🔧 設定

### secrets.toml設定（オプション）

```bash
# テンプレートをコピー
cp .streamlit/secrets.toml.template .streamlit/secrets.toml

# 必要に応じて設定を調整
# デフォルト設定で問題なく動作します
```

### 主要設定項目
- **API制限**: 1時間100リクエスト、1分5リクエスト
- **キャッシュ**: 15分間有効
- **ファイルサイズ**: CSV 200MB制限

## 📊 データソース

### 🏦 証券会社CSV（ポートフォリオデータ）
- **楽天証券**: assetbalance形式（UTF-8/Shift_JIS対応）
- **SBI証券**: SaveFile形式（Shift_JIS対応）
- **処理実績**: 楽天25件+SBI7件 = 32件データ正常処理
- **統一変換**: 銘柄コード・単位・損益率の自動正規化

### 🌐 Yahoo Finance API（市場データ）
- **株価データ**: リアルタイム（15-20分遅れ）
- **財務指標**: PER・PBR・配当利回り・ROE
- **配当履歴**: 通常5-10年分
- **対象市場**: 日本株・米国株・その他
- **API制限**: 適応的管理（1時間100リクエスト）

### 🏛️ J-Quants API（準備完了・95%統合可能性）
- **日本取引所公式**: 信頼性最高のデータソース
- **四半期財務**: 決算トレンド分析用
- **市場センチメント**: 空売り比率・信用残高
- **機関投資家動向**: 投資部門別売買データ
- **統合予定**: Phase 2で実装予定

### 対応銘柄形式
- **統一形式**: `9432` (4桁数字、.Tなし)
- **自動変換**: `9432.T` → `9432`, `"1928"` → `1928`
- **日本株例**: `1928` (積水ハウス), `7203` (トヨタ)
- **米国株**: `AAPL` (Apple), `MSFT` (Microsoft)

## ⚠️ トラブルシューティング

### よくある問題

1. **Streamlit起動エラー**
```bash
pip install --upgrade streamlit
streamlit --version
```

2. **Yahoo Finance APIエラー**
- ネットワーク接続確認
- API制限チェック（サイドバーで確認）
- 銘柄コード形式確認

3. **CSV読み込みエラー**
- SBI・楽天証券の形式確認
- ファイルエンコーディング（UTF-8, Shift-JIS対応）
- ファイルサイズ制限（200MB）

4. **パフォーマンス問題**
```bash
# キャッシュクリア
streamlit cache clear

# ポート変更
streamlit run app.py --server.port 8502
```

## 🛡️ セキュリティ・プライバシー

- **データ保護**: ローカル実行、外部送信なし
- **API認証**: Yahoo Finance APIは無料・認証不要
- **一時ファイル**: 自動削除機能
- **機密情報**: secrets.toml は .gitignore で保護

## 🔄 開発・貢献

### 開発環境
- Python 3.8+
- Streamlit 1.28.0+
- 統一データ処理アーキテクチャ

### コーディング規約
- UTF-8エンコーディング
- 統一キー使用義務
- 生データ直接アクセス禁止
- エラーハンドリング必須

### テスト実行
```bash
pytest tests/
```

## 📈 バージョン履歴

### v2.0.0 (Current) - 統一データベース
- 🏗️ **「両方の真実保持」データベース設計**
- 🔥 **単位不一致問題完全解決**（SBI167.98% vs Yahoo0.1598）
- 📊 **EnhancedCSVParser**（32件データ正常処理）
- ⚡ **適応的API制限管理システム**
- 🎯 **銘柄コード統一**（.T除去、小数点1桁）
- ✅ **J-Quants統合準備完了**（95%適合性確認）
- 🗄️ **SQLiteデータベース**（5テーブル構成）

### v0.3.0
- 🎯 統一データ処理アーキテクチャ実装
- 📊 異常値検出・自動修正機能
- 🛡️ 3段階警告システム
- ✅ 実銘柄検証完了（積水ハウス他5銘柄）

### v0.2.2
- 🔥 配当利回り計算バグ修正（477% → 4.77%）
- 🛡️ 財務指標異常値検出強化
- 🔧 Yahoo Finance API対応改善

### v0.1.0
- 📱 Streamlit Web版初期リリース
- 💼 ポートフォリオ管理機能
- 👀 監視リスト機能

## 🔮 今後の予定

### Phase 2: J-Quants統合
- 🏛️ J-Quants API実装（95%準備完了）
- 📈 四半期決算トレンド分析
- 📊 市場センチメント分析（空売り比率等）

### Phase 3: 高度分析機能
- 🤖 機関投資家動向分析
- 📅 決算発表スケジュール連携
- 🎯 投資タイミング最適化

## 📞 サポート・フィードバック

- **GitHub Issues**: [報告・要望](https://github.com/inata169/J_Stock_StreamlitV2/issues)
- **開発仕様**: `CLAUDE.md` 参照
- **ライセンス**: MIT License

## 🎯 プロジェクト哲学

**オルカン投資 + 学習ツール**
- **合理的投資**: インデックス投資による着実な資産形成
- **知的探求**: このツールによる金融・技術スキルの向上
- **実践学習**: データ分析・プログラミング・投資理論の習得

**Version 2.0の設計思想**
- **透明性**: 「両方の真実を保持」でデータソースを明示
- **正確性**: 単位不一致問題を完全解決
- **拡張性**: J-Quants統合に向けた堅固な基盤
- **学習価値**: データベース設計・API管理の実践的習得

---

**⚠️ 免責事項**: このツールは教育・学習目的のみです。投資判断は必ずご自身の責任で行ってください。データの正確性は保証されません。